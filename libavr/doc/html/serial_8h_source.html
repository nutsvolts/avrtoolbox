<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libavr: serial.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>serial.h</h1>  </div>
</div>
<div class="contents">
<a href="serial_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">$Date: 2011-06-20 12:43:24 -0400 (Mon, 20 Jun 2011) $</span>
<a name="l00003"></a>00003 <span class="comment">$Revision: 96 $</span>
<a name="l00004"></a>00004 <span class="comment">$HeadURL: https://avrtoolbox.googlecode.com/svn/trunk/libavr/source/elementary/serial/serial.h $</span>
<a name="l00005"></a>00005 <span class="comment">$Author: smiley.micros@gmail.com $</span>
<a name="l00006"></a>00006 <span class="comment">*/</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">/*</span>
<a name="l00009"></a>00009 <span class="comment"> *  BSD License</span>
<a name="l00010"></a>00010 <span class="comment"> *  -----------</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *  Copyright (c) 2011, and Joe Pardue, All rights reserved.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *  Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> *  modification, are permitted provided that the following conditions are met:</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *  - Redistributions of source code must retain the above copyright notice,</span>
<a name="l00018"></a>00018 <span class="comment"> *    this list of conditions and the following disclaimer. </span>
<a name="l00019"></a>00019 <span class="comment"> *   </span>
<a name="l00020"></a>00020 <span class="comment"> *  - Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00021"></a>00021 <span class="comment"> *    this list of conditions and the following disclaimer in the documentation</span>
<a name="l00022"></a>00022 <span class="comment"> *    and/or other materials provided with the distribution. </span>
<a name="l00023"></a>00023 <span class="comment"> *   </span>
<a name="l00024"></a>00024 <span class="comment"> *  - Neither the name of Joe Pardue nor the names of </span>
<a name="l00025"></a>00025 <span class="comment"> *    its contributors may be used to endorse or promote products derived from </span>
<a name="l00026"></a>00026 <span class="comment"> *    this software without specific prior written permission. </span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="l00029"></a>00029 <span class="comment"> *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00030"></a>00030 <span class="comment"> *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00031"></a>00031 <span class="comment"> *  ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00032"></a>00032 <span class="comment"> *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00033"></a>00033 <span class="comment"> *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00034"></a>00034 <span class="comment"> *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00035"></a>00035 <span class="comment"> *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00036"></a>00036 <span class="comment"> *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00037"></a>00037 <span class="comment"> *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00038"></a>00038 <span class="comment"> *  POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a>00040  
<a name="l00041"></a>00041  <span class="comment">// Some of this code may have elements taken from other code without attribution.</span>
<a name="l00042"></a>00042  <span class="comment">// If this is the case it was due to oversight while debugging and I apologize.</span>
<a name="l00043"></a>00043  <span class="comment">// If anyone has any reason to believe that any of this code violates other licenses</span>
<a name="l00044"></a>00044  <span class="comment">// please contact me with details so that I may correct the situation. </span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#ifndef SERIAL_H</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#define SERIAL_H</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="comment">//#include &quot;..\devices\devices.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;c:\avrtoolbox\libavr\source\driver\usart\usart.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;c:\avrtoolbox\libavr\source\general\util\util.h&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="serial_8h.html#a40a23426125d250794b4e6a3e7d0e9c5">00053</a> <span class="preprocessor">#define BUFFER_DELAY 20</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">/*!</span>
<a name="l00056"></a>00056 <span class="comment">        \defgroup serial Elementary Serial Communications Functions</span>
<a name="l00057"></a>00057 <span class="comment">*/</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">/*! </span>
<a name="l00060"></a>00060 <span class="comment">        \ingroup serial</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">        \brief Gets the number of bytes that have arrived from the serial port and are available for reading from the 128 byte buffer.</span>
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">        \return uint8_t bytes available in the serial receive buffer up to 128.</span>
<a name="l00065"></a>00065 <span class="comment">        </span>
<a name="l00066"></a>00066 <span class="comment">        Example:</span>
<a name="l00067"></a>00067 <span class="comment">        \code</span>
<a name="l00068"></a>00068 <span class="comment">        void loop()</span>
<a name="l00069"></a>00069 <span class="comment">        {</span>
<a name="l00070"></a>00070 <span class="comment">                if(serial_available() &gt; 16) </span>
<a name="l00071"></a>00071 <span class="comment">                {</span>
<a name="l00072"></a>00072 <span class="comment">                        process_serial_input();</span>
<a name="l00073"></a>00073 <span class="comment">                }</span>
<a name="l00074"></a>00074 <span class="comment">        }</span>
<a name="l00075"></a>00075 <span class="comment">        \endcode</span>
<a name="l00076"></a>00076 <span class="comment">*/</span>
<a name="l00077"></a>00077 uint8_t <a class="code" href="group__serial.html#ga7a8efe7f4cd2338deff8bd2c52a6f56b" title="Gets the number of bytes that have arrived from the serial port and are available for reading from th...">serial_available</a>(<span class="keywordtype">void</span>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">/*! </span>
<a name="l00081"></a>00081 <span class="comment">        \ingroup serial</span>
<a name="l00082"></a>00082 <span class="comment"></span>
<a name="l00083"></a>00083 <span class="comment">         Sets up the serial communication with the transmission data rate (baudrate).</span>
<a name="l00084"></a>00084 <span class="comment">        </span>
<a name="l00085"></a>00085 <span class="comment">        \param baudrate: 32-bit integer (uint32_t). Recommended that you only use one of the standard rates of: 300, 1200, 2400, 4800, 9600, 14400, 19200, 28800, 38400, 57600, or 115200.</span>
<a name="l00086"></a>00086 <span class="comment">        </span>
<a name="l00087"></a>00087 <span class="comment">        Example:</span>
<a name="l00088"></a>00088 <span class="comment">        \code   </span>
<a name="l00089"></a>00089 <span class="comment">        void setup()</span>
<a name="l00090"></a>00090 <span class="comment">        {</span>
<a name="l00091"></a>00091 <span class="comment">                // Set up serial port for 57600 baud</span>
<a name="l00092"></a>00092 <span class="comment">                serial_begin(57600);</span>
<a name="l00093"></a>00093 <span class="comment">        }</span>
<a name="l00094"></a>00094 <span class="comment">        \endcode</span>
<a name="l00095"></a>00095 <span class="comment">*/</span>
<a name="l00096"></a>00096 <span class="keywordtype">void</span> <a class="code" href="group__serial.html#ga2559ff325a5d03218c7020e0f0e6dcda">serial_begin</a>(uint32_t baudrate);
<a name="l00097"></a>00097 <span class="comment"></span>
<a name="l00098"></a>00098 <span class="comment">/*! </span>
<a name="l00099"></a>00099 <span class="comment">        \ingroup serial</span>
<a name="l00100"></a>00100 <span class="comment"></span>
<a name="l00101"></a>00101 <span class="comment">        \brief Returns the serial communications elements to their default values.</span>
<a name="l00102"></a>00102 <span class="comment">        </span>
<a name="l00103"></a>00103 <span class="comment">        Example:</span>
<a name="l00104"></a>00104 <span class="comment">        \code   </span>
<a name="l00105"></a>00105 <span class="comment">        void shut_down()</span>
<a name="l00106"></a>00106 <span class="comment">        {</span>
<a name="l00107"></a>00107 <span class="comment">                serial_end();</span>
<a name="l00108"></a>00108 <span class="comment">                sleep();</span>
<a name="l00109"></a>00109 <span class="comment">        }</span>
<a name="l00110"></a>00110 <span class="comment">        \endcode</span>
<a name="l00111"></a>00111 <span class="comment">*/</span>
<a name="l00112"></a>00112 <span class="keywordtype">void</span> <a class="code" href="group__serial.html#ga1c3bc0d4ec8ae917b559e0788a1e2536" title="Returns the serial communications elements to their default values.">serial_end</a>(<span class="keywordtype">void</span>);
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">/*! </span>
<a name="l00115"></a>00115 <span class="comment">        \ingroup serial</span>
<a name="l00116"></a>00116 <span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment">        \brief Clear out any data in the serial buffer. Subsequent calls to serial_in() or serial_available() will only return data that has arrived since the call to serial_flush().</span>
<a name="l00118"></a>00118 <span class="comment">        </span>
<a name="l00119"></a>00119 <span class="comment">        Example:</span>
<a name="l00120"></a>00120 <span class="comment">        \code</span>
<a name="l00121"></a>00121 <span class="comment">        // Received unknown command, restart the conversation </span>
<a name="l00122"></a>00122 <span class="comment">        serial_out(&quot;Unknown command: %d, flushing buffer.&quot;, last_command);</span>
<a name="l00123"></a>00123 <span class="comment">        // Throw out everything</span>
<a name="l00124"></a>00124 <span class="comment">        serial_flush();</span>
<a name="l00125"></a>00125 <span class="comment">        \endcode</span>
<a name="l00126"></a>00126 <span class="comment"></span>
<a name="l00127"></a>00127 <span class="comment">*/</span>
<a name="l00128"></a>00128 <span class="keywordtype">void</span> <a class="code" href="group__serial.html#ga04858117b8541474fe79c45a044b59cc" title="Clear out any data in the serial buffer. Subsequent calls to serial_in() or serial_available() will o...">serial_flush</a>(<span class="keywordtype">void</span>);
<a name="l00129"></a>00129 <span class="comment"></span>
<a name="l00130"></a>00130 <span class="comment">/*! </span>
<a name="l00131"></a>00131 <span class="comment">        \ingroup serial</span>
<a name="l00132"></a>00132 <span class="comment"></span>
<a name="l00133"></a>00133 <span class="comment">        \brief Inputs incoming serial data one byte at a time, returns -1 if no data is available.</span>
<a name="l00134"></a>00134 <span class="comment">        </span>
<a name="l00135"></a>00135 <span class="comment">        \return 8-bit signed integer (int8_t) - the first byte of incoming data or returns -1 if no data available.</span>
<a name="l00136"></a>00136 <span class="comment"></span>
<a name="l00137"></a>00137 <span class="comment">        Example:</span>
<a name="l00138"></a>00138 <span class="comment">        \code   </span>
<a name="l00139"></a>00139 <span class="comment">        // Define and receive a serial byte</span>
<a name="l00140"></a>00140 <span class="comment">        int8_t myByte = serial_in();</span>
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">        // Is it &#39;!&#39;</span>
<a name="l00143"></a>00143 <span class="comment">        if(myByte == &#39;!&#39;)</span>
<a name="l00144"></a>00144 <span class="comment">        {</span>
<a name="l00145"></a>00145 <span class="comment">                process_exclamation();</span>
<a name="l00146"></a>00146 <span class="comment">        }       </span>
<a name="l00147"></a>00147 <span class="comment">        \endcode</span>
<a name="l00148"></a>00148 <span class="comment">        </span>
<a name="l00149"></a>00149 <span class="comment">*/</span>
<a name="l00150"></a>00150 uint8_t <a class="code" href="group__serial.html#ga02db400d599afe33dceff17cd281f8c3" title="Inputs incoming serial data one byte at a time, returns -1 if no data is available.">serial_in</a>(<span class="keywordtype">void</span>);
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">/*! </span>
<a name="l00153"></a>00153 <span class="comment">        \ingroup serial </span>
<a name="l00154"></a>00154 <span class="comment"></span>
<a name="l00155"></a>00155 <span class="comment">        \brief Outputs formatted data based on conversion symbols and escape character sequences contained in a string of text. </span>
<a name="l00156"></a>00156 <span class="comment">        Syntax: serial_out(string_with_N_data_format_symbols, data1, data2, ... dataN);</span>
<a name="l00157"></a>00157 <span class="comment"></span>
<a name="l00158"></a>00158 <span class="comment">        \param buff pointer to a string with format data.</span>
<a name="l00159"></a>00159 <span class="comment">        \param size uint8_t number of characters in the buffer.</span>
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">        \return The number of characters printed or a negative number if an error occurred.</span>
<a name="l00162"></a>00162 <span class="comment">        </span>
<a name="l00163"></a>00163 <span class="comment">        \note</span>
<a name="l00164"></a>00164 <span class="comment">        Conversion symbols: </span>
<a name="l00165"></a>00165 <span class="comment">        %c - print an ASCII character</span>
<a name="l00166"></a>00166 <span class="comment">        %s - print a character string</span>
<a name="l00167"></a>00167 <span class="comment">        %d or %i - print a decimal integer</span>
<a name="l00168"></a>00168 <span class="comment">        %x - print a hexadecimal integer. Note that we usually precede this with the characters 0x to output, for instance if the hexadecimal number is 5A, the output will be 0x5A.</span>
<a name="l00169"></a>00169 <span class="comment"></span>
<a name="l00170"></a>00170 <span class="comment">        Control characters:</span>
<a name="l00171"></a>00171 <span class="comment">        \n - print a new line</span>
<a name="l00172"></a>00172 <span class="comment">        \&quot; - print a quotation mark</span>
<a name="l00173"></a>00173 <span class="comment">        \\ - print a forward slash      </span>
<a name="l00174"></a>00174 <span class="comment">        </span>
<a name="l00175"></a>00175 <span class="comment">        Examples:</span>
<a name="l00176"></a>00176 <span class="comment">        \code   </span>
<a name="l00177"></a>00177 <span class="comment">        Example 1: </span>
<a name="l00178"></a>00178 <span class="comment">        uint8_t my_char = &#39;!&#39;;</span>
<a name="l00179"></a>00179 <span class="comment">        uint8_t my_string[] = { &#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, 0};</span>
<a name="l00180"></a>00180 <span class="comment">        my_byte = 42;</span>
<a name="l00181"></a>00181 <span class="comment"></span>
<a name="l00182"></a>00182 <span class="comment">        serial_out(&quot;Print a character: %c, a string: %c, a decimal integer: %d, a hexadecimal integer: 0x%X, a forward slash: \\, a quote: \&quot;, a new line: \n next line.&quot;, my_char, my_string, my_byte, my_byte);</span>
<a name="l00183"></a>00183 <span class="comment"></span>
<a name="l00184"></a>00184 <span class="comment">        Which shows in the terminal as: </span>
<a name="l00185"></a>00185 <span class="comment">        Print a character: !, a string: Hello, a decimal integer: 42, a hexadecimal integer: 0x2A, a forward slash \, a quote &quot;, and a new line:</span>
<a name="l00186"></a>00186 <span class="comment">        next line.</span>
<a name="l00187"></a>00187 <span class="comment"></span>
<a name="l00188"></a>00188 <span class="comment">        Example 2:</span>
<a name="l00189"></a>00189 <span class="comment">        uint8_t  my_day = 21;</span>
<a name="l00190"></a>00190 <span class="comment">        uint8_t my_month[] = {&#39;J&#39;,&#39;u&#39;,&#39;l&#39;,&#39;y&#39;,0};</span>
<a name="l00191"></a>00191 <span class="comment">        uint16_t my_year = 1980;</span>
<a name="l00192"></a>00192 <span class="comment"></span>
<a name="l00193"></a>00193 <span class="comment">        serial_out( &quot;Your date of birth is:\n Day %d \nMonth: %s  \nYear %d.&quot;, my_day, my_month, my_year); </span>
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">        Which shows in the terminal as: </span>
<a name="l00196"></a>00196 <span class="comment"></span>
<a name="l00197"></a>00197 <span class="comment">        Your date of birth is:</span>
<a name="l00198"></a>00198 <span class="comment">        Day 21</span>
<a name="l00199"></a>00199 <span class="comment">        Month July</span>
<a name="l00200"></a>00200 <span class="comment">        Year 1980</span>
<a name="l00201"></a>00201 <span class="comment">        \endcode</span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">        \note More advanced users may note that this is a macro wrapper for the C Standard Library printf() function with the string stored in flash and the output directed to the USART, but the documentation here is kept simple for use by novices. If you want to use floating point conversions - DON&#39;T. That facility is not included since it causes the code size to increase more than is warranted by the convenience. If you really need floating point consider using the special printf() functions as documented in avrlibc.</span>
<a name="l00205"></a>00205 <span class="comment">*/</span>
<a name="l00206"></a>00206 <span class="keywordtype">void</span> <a class="code" href="group__serial.html#gafa8f73ae47320346b1efb251ac188d45" title="Outputs formatted data based on conversion symbols and escape character sequences contained in a stri...">serial_out</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);
<a name="l00207"></a>00207 <span class="comment"></span>
<a name="l00208"></a>00208 <span class="comment">/*! </span>
<a name="l00209"></a>00209 <span class="comment">        \ingroup serial</span>
<a name="l00210"></a>00210 <span class="comment"></span>
<a name="l00211"></a>00211 <span class="comment">        \brief Outputs the indicated number of bytes</span>
<a name="l00212"></a>00212 <span class="comment">        </span>
<a name="l00213"></a>00213 <span class="comment">        \param *buff a pointer to a uint8_t buffer</span>
<a name="l00214"></a>00214 <span class="comment">        \param size uint8_t number of buffer elements to output</span>
<a name="l00215"></a>00215 <span class="comment"></span>
<a name="l00216"></a>00216 <span class="comment">        Example:</span>
<a name="l00217"></a>00217 <span class="comment">        \code   </span>
<a name="l00218"></a>00218 <span class="comment">        for(int i = 0 ; i &lt; count; i++)</span>
<a name="l00219"></a>00219 <span class="comment">        {</span>
<a name="l00220"></a>00220 <span class="comment">                buf[i] = serial_in();</span>
<a name="l00221"></a>00221 <span class="comment">        }</span>
<a name="l00222"></a>00222 <span class="comment">                        </span>
<a name="l00223"></a>00223 <span class="comment">        serial_write(buf,count);</span>
<a name="l00224"></a>00224 <span class="comment">        </span>
<a name="l00225"></a>00225 <span class="comment">        \endcode</span>
<a name="l00226"></a>00226 <span class="comment">        </span>
<a name="l00227"></a>00227 <span class="comment">*/</span>
<a name="l00228"></a>00228 <span class="keywordtype">void</span> <a class="code" href="group__serial.html#gaf5d688600f05137b44dd915a9bb0686c" title="Outputs the indicated number of bytes.">serial_write</a>(uint8_t *buff, uint8_t size);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="preprocessor">#endif</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>
<a name="l00235"></a>00235 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Sep 14 2011 16:28:29 for libavr by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
