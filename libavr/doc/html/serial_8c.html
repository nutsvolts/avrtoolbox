<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libavr: serial.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>serial.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;c:\avrtoolbox\libavr\source\driver\usart\usart0.h&quot;</code><br/>
<code>#include &lt;util\delay.h&gt;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a99096248a506221d8799095601b91bc2">serial_printf</a>(val1, val2)&nbsp;&nbsp;&nbsp;{printf_P(PSTR(val1),val2); if(usart0_transmit_buffer_inuse_count() &gt; ((2*USART0_TRANSMIT_BUFFER_LEN)/3)) delay(10);}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#ab5187269936538ffb8ccbbe7115ffdbc">MAX_STRING</a>&nbsp;&nbsp;&nbsp;255</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a2559ff325a5d03218c7020e0f0e6dcda">serial_begin</a> (uint32_t baudrate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a1c3bc0d4ec8ae917b559e0788a1e2536">serial_end</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#aae486386df02d9299c8739693f7fb38a">serial_print</a> (char *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a14aa9663300209681dcf18bd32a9855c">serial_println</a> (char *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a7a8efe7f4cd2338deff8bd2c52a6f56b">serial_available</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a1ddec0fce87f4da8ec113cec57744a61">serial_read</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#af5d688600f05137b44dd915a9bb0686c">serial_write</a> (uint8_t *buff, uint8_t size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#a04858117b8541474fe79c45a044b59cc">serial_flush</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="serial_8c.html#adb7db4d9ef946dcfb58bcfc667ee674a">delay</a> (uint16_t ms)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ab5187269936538ffb8ccbbe7115ffdbc"></a><!-- doxytag: member="serial.c::MAX_STRING" ref="ab5187269936538ffb8ccbbe7115ffdbc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_STRING&nbsp;&nbsp;&nbsp;255</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a99096248a506221d8799095601b91bc2"></a><!-- doxytag: member="serial.c::serial_printf" ref="a99096248a506221d8799095601b91bc2" args="(val1, val2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define serial_printf</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">val1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">val2</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td>&nbsp;&nbsp;&nbsp;{printf_P(PSTR(val1),val2); if(usart0_transmit_buffer_inuse_count() &gt; ((2*USART0_TRANSMIT_BUFFER_LEN)/3)) delay(10);}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adb7db4d9ef946dcfb58bcfc667ee674a"></a><!-- doxytag: member="serial.c::delay" ref="adb7db4d9ef946dcfb58bcfc667ee674a" args="(uint16_t ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delay </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>ms</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7a8efe7f4cd2338deff8bd2c52a6f56b"></a><!-- doxytag: member="serial.c::serial_available" ref="a7a8efe7f4cd2338deff8bd2c52a6f56b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t serial_available </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets the number of bytes that have arrived from the serial port and are available for reading from the 128 byte buffer. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>uint8_t bytes available in the serial receive buffer – up to 128.</dd></dl>
<div class="fragment"><pre class="fragment">        Example:
        <span class="keywordtype">void</span> loop()
        {
                <span class="keywordflow">if</span>(<a class="code" href="serial_8c.html#a7a8efe7f4cd2338deff8bd2c52a6f56b" title="Gets the number of bytes that have arrived from the serial port and are available for reading from th...">serial_available</a>() &gt; 16) 
                {
                        process_serial_input();
                }
        }
</pre></div> 
</div>
</div>
<a class="anchor" id="a2559ff325a5d03218c7020e0f0e6dcda"></a><!-- doxytag: member="serial.c::serial_begin" ref="a2559ff325a5d03218c7020e0f0e6dcda" args="(uint32_t baudrate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_begin </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>baudrate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets up the serial communication with the transmission data rate (baudrate).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>baudrate,:</em>&nbsp;</td><td>32-bit integer (uint32_t). Recommended that you only use one of the standard rates of: 300, 1200, 2400, 4800, 9600, 14400, 19200, 28800, 38400, 57600, or 115200.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
<div class="fragment"><pre class="fragment">        Example:
        <span class="keywordtype">void</span> setup()
        {
                <span class="comment">// Set up serial port for 57600 baud</span>
                <a class="code" href="serial_8c.html#a2559ff325a5d03218c7020e0f0e6dcda">serial_begin</a>(57600);
        }
</pre></div> 
</div>
</div>
<a class="anchor" id="a1c3bc0d4ec8ae917b559e0788a1e2536"></a><!-- doxytag: member="serial.c::serial_end" ref="a1c3bc0d4ec8ae917b559e0788a1e2536" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_end </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the serial communications elements to their default values. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>None</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Nothing</dd></dl>
<div class="fragment"><pre class="fragment">        Example:
        <span class="keywordtype">void</span> shut_down()
        {
                <a class="code" href="serial_8c.html#a1c3bc0d4ec8ae917b559e0788a1e2536" title="Returns the serial communications elements to their default values.">serial_end</a>();
                sleep();
        }
</pre></div> 
</div>
</div>
<a class="anchor" id="a04858117b8541474fe79c45a044b59cc"></a><!-- doxytag: member="serial.c::serial_flush" ref="a04858117b8541474fe79c45a044b59cc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_flush </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clear out any data in the serial buffer. Subsequent calls to <a class="el" href="serial_8h.html#a02db400d599afe33dceff17cd281f8c3" title="Inputs incoming serial data one byte at a time, returns –1 if no data is available.">serial_in()</a> or <a class="el" href="serial_8c.html#a7a8efe7f4cd2338deff8bd2c52a6f56b" title="Gets the number of bytes that have arrived from the serial port and are available for reading from th...">serial_available()</a> will only return data that has arrived since the call to <a class="el" href="serial_8c.html#a04858117b8541474fe79c45a044b59cc" title="Clear out any data in the serial buffer. Subsequent calls to serial_in() or serial_available() will o...">serial_flush()</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
<div class="fragment"><pre class="fragment">        Example:
        <span class="comment">// Received unknown command, restart the conversation </span>
        <a class="code" href="serial_8h.html#afa8f73ae47320346b1efb251ac188d45">serial_out</a>(“Unknown command: %d, flushing buffer.”, last_command);
        <span class="comment">// Throw out everything</span>
        <a class="code" href="serial_8c.html#a04858117b8541474fe79c45a044b59cc" title="Clear out any data in the serial buffer. Subsequent calls to serial_in() or serial_available() will o...">serial_flush</a>();
</pre></div> 
</div>
</div>
<a class="anchor" id="aae486386df02d9299c8739693f7fb38a"></a><!-- doxytag: member="serial.c::serial_print" ref="aae486386df02d9299c8739693f7fb38a" args="(char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_print </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a14aa9663300209681dcf18bd32a9855c"></a><!-- doxytag: member="serial.c::serial_println" ref="a14aa9663300209681dcf18bd32a9855c" args="(char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_println </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a1ddec0fce87f4da8ec113cec57744a61"></a><!-- doxytag: member="serial.c::serial_read" ref="a1ddec0fce87f4da8ec113cec57744a61" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t serial_read </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af5d688600f05137b44dd915a9bb0686c"></a><!-- doxytag: member="serial.c::serial_write" ref="af5d688600f05137b44dd915a9bb0686c" args="(uint8_t *buff, uint8_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial_write </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Outputs formatted data based on conversion symbols and escape character sequences contained in a string of text. Syntax: serial_out(string_with_N_data_format_symbols, data1, data2, … dataN);. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>First</em>&nbsp;</td><td>parameter: string with data to format Following parameters: the data to be formatted for printing in the first parameter string.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of characters printed or a negative number if an error occurred.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Conversion symbols: c – print an ASCII character s – print a character string d or i – print a decimal integer x – print a hexadecimal integer. Note that we usually precede this with the characters 0x to output, for instance if the hexadecimal number is 5A, the output will be 0x5A.</dd></dl>
<p>Control characters: <br/>
 – print a new line \” – print a quotation mark \ - print a forward slash</p>
<div class="fragment"><pre class="fragment">        Example 1: 
        uint8_t my_char = ‘!’;
        uint8_t my_string[] = { ‘H’, ‘e’, ‘l’, ‘l’, ‘o’, 0};
        my_byte = 42;

        <a class="code" href="serial_8h.html#afa8f73ae47320346b1efb251ac188d45">serial_out</a>(“Print a character: %c, a <span class="keywordtype">string</span>: %c, a decimal integer: %d, a hexadecimal integer: 0x%X, a forward slash: \\, a quote: \”, a <span class="keyword">new</span> line: \n next line.”, my_char, my_string, my_byte, my_byte);

        Which shows in the terminal as: 
        Print a character: !, a <span class="keywordtype">string</span>: Hello, a decimal integer: 42, a hexadecimal integer: 0x2A, a forward slash \, a quote “, and a <span class="keyword">new</span> line:
        next line.

        Example 2:
        uint8_t  my_day = 21;
        uint8_t my_month[] = {‘J’,’u’,’l’,’y’,0};
        uint16_t my_year = 1980;

        <a class="code" href="serial_8h.html#afa8f73ae47320346b1efb251ac188d45">serial_out</a>( “Your date of birth is:\n Day %d \nMonth: %s  \nYear %d.”, my_day, my_month, my_year); 

        Which shows in the terminal as: 

        Your date of birth is:
        Day 21
        Month July
        Year 1980
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>More advanced users may note that this is a macro wrapper for the standard library printf() function with the string stored in flash and the output directed to the USART, but the documentation here is kept simple for use by novices. If you want to use floating point conversions – DON’T. That facility is not included since it causes the code size to increase more than is warranted by the convenience. If you really need floating point consider using the special printf() functions as documented in avrlibc. </dd></dl>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat May 7 2011 15:54:10 for libavr by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
